## 1. 实施修复

- [ ] 1.1 修改 `backend/src/app/services/agent_service.py` 中的文件模式系统指令
  - [ ] 将系统指令升级为"核威慑"级别
  - [ ] 使用 `SYSTEM ALERT`、`DISCONNECTED` 等强硬词汇
  - [ ] 明确说明 `query` 工具会导致系统崩溃
  - [ ] 强调只能使用 `analyze_dataframe` 和 `inspect_file` 工具

- [ ] 1.2 增强日志记录
  - [ ] 记录文件模式检测结果
  - [ ] 记录系统指令的完整内容
  - [ ] 记录工具调用决策过程

- [ ] 1.3 测试验证
  - [ ] 使用 Excel 文件进行测试
  - [ ] 验证 Agent 不再调用 SQL 工具
  - [ ] 验证系统不再崩溃
  - [ ] 验证返回的数据是真实的文件数据，而不是幻觉数据

## 2. 验证和测试

- [ ] 2.1 功能测试
  - [ ] 测试 Excel 文件查询
  - [ ] 测试 CSV 文件查询
  - [ ] 验证工具调用日志

- [ ] 2.2 错误场景测试
  - [ ] 验证系统指令是否正确注入
  - [ ] 验证错误处理是否正常工作

