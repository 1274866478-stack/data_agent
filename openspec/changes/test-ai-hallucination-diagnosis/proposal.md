# Change: AI助手编造数据问题诊断测试计划

## Why

AI助手在回答"列出所有的用户"时，返回了编造的假数据（用户1、用户2、用户3、用户4、用户5），而不是从数据库中查询的真实数据。这是一个严重的数据准确性问题，需要系统性地诊断和定位根本原因。

根据现有文档分析，可能的原因包括：
1. **工具调用根本没有发生** - AI跳过了必要的工具调用步骤
2. **工具调用失败但错误处理不当** - 工具失败时AI仍然生成答案
3. **工具返回的数据被忽略** - 工具成功返回真实数据，但AI使用了训练数据
4. **Prompt不够强制** - 虽然prompt中有警告，但AI仍然违反规则

需要创建一个系统性的测试计划来诊断和定位问题的根本原因。

## What Changes

- 创建系统性的测试计划，包括5个阶段的测试：
  1. **基础验证测试** - 验证数据库连接和工具可用性
  2. **工具调用流程测试** - 验证AI是否会调用工具，以及工具调用失败时的行为
  3. **数据一致性验证测试** - 对比工具返回的数据和AI回答中的数据
  4. **Prompt和响应生成测试** - 验证Prompt的有效性和消息传递机制
  5. **端到端集成测试** - 完整流程测试和边界情况测试

- 创建测试脚本和工具：
  - 工具调用测试脚本
  - Agent执行测试脚本
  - 数据一致性验证脚本
  - 日志分析脚本

- 生成诊断报告，包含：
  - 问题根源分析
  - 数据一致性对比报告
  - 工具调用统计报告
  - 修复建议

## Impact

- **受影响的功能**：AI助手查询功能
- **受影响的代码**：
  - `backend/src/app/services/agent/agent_service.py` - Agent服务
  - `backend/src/app/services/agent/prompts.py` - System Prompt
  - `backend/src/app/services/agent/tools.py` - 工具定义
  - `backend/src/app/api/v1/endpoints/query.py` - 查询端点
- **测试范围**：需要覆盖所有数据源类型（SQL数据库、Excel/CSV文件）
- **预期输出**：诊断报告和修复建议

