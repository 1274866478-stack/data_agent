## 1. 实现流式API客户端
- [ ] 1.1 在 `api-client.ts` 中添加 `streamChatCompletion` 方法，支持SSE流式调用并接受 `AbortSignal` 参数
- [ ] 1.2 实现流式响应解析器，处理 `data: {...}` 格式的SSE消息
- [ ] 1.3 支持流式响应的事件类型：
  - `content` (普通对话文本)
  - `thinking` (Agent的思考过程/CoT)
  - `tool_input` (生成的SQL代码或参数)
  - `tool_output` (查询到的数据结果/JSON)
  - `error`, `done`
- [ ] 1.4 添加错误处理、连接中断处理及手动取消请求的处理

## 2. 更新聊天状态管理
- [ ] 2.1 修改 `chatStore.sendMessage` 方法，支持流式模式并保存 `AbortController` 实例
- [ ] 2.2 实现流式内容的增量更新逻辑（文本追加，结构化数据替换）
- [ ] 2.3 添加流式状态管理（streaming, analyzing_sql, generating_chart 等细分状态）
- [ ] 2.4 优化缓存策略：仅在流结束 (done) 后将完整消息写入持久化存储/缓存，避免保存不完整的截断消息
- [ ] 2.5 处理流式响应中的思考过程（thinking）显示，支持折叠/展开思考过程

## 3. 更新UI组件
- [ ] 3.1 修改消息显示组件，支持实时更新流式内容
- [ ] 3.2 添加流式响应的视觉反馈（光标闪烁、打字动画）
- [ ] 3.3 增强Markdown渲染器：处理流式传输中不完整的Markdown语法（如未闭合的代码块），防止布局跳动
- [ ] 3.4 处理流式响应中的SQL执行和图表生成：
  - 实现"流式JSON解析器"：尝试解析不完整的JSON字符串，以便尽早渲染图表骨架
  - 当接收到SQL时，高亮显示SQL代码块
- [ ] 3.5 添加"停止生成"按钮，允许用户中途中断流

## 4. 集成和测试
- [ ] 4.1 在AI助手页面集成流式响应功能
- [ ] 4.2 测试流式响应的基本功能
- [ ] 4.3 专项测试：长文本SQL生成的流式表现（是否卡顿）
- [ ] 4.4 测试错误处理、连接中断及用户手动取消场景
- [ ] 4.5 验证向后兼容性（非流式模式仍然工作）
- [ ] 4.6 性能测试：监控前端内存占用（长时间流式对话是否导致内存泄漏）

