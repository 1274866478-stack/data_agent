# ğŸš¨ å¦‚ä½•æŸ¥çœ‹å®æ—¶æ—¥å¿—ï¼ˆCriticalï¼‰

æ ¹æ® Network æˆªå›¾åˆ†æï¼Œ83ç§’çš„æ‰§è¡Œæ—¶é—´è¡¨æ˜å¯èƒ½å­˜åœ¨è¶…æ—¶æˆ–å·¥å…·è°ƒç”¨å¤±è´¥ã€‚ä»¥ä¸‹æ˜¯æŸ¥çœ‹å®æ—¶æ—¥å¿—çš„æ–¹æ³•ï¼š

## æ–¹æ³•ä¸€ï¼šDocker ç¯å¢ƒæŸ¥çœ‹æ—¥å¿—

### 1. æŸ¥çœ‹æ‰€æœ‰æœåŠ¡æ—¥å¿—
```bash
# æŸ¥çœ‹æ‰€æœ‰å®¹å™¨çš„æ—¥å¿—
docker-compose logs -f

# æˆ–è€…åªæŸ¥çœ‹åç«¯æœåŠ¡æ—¥å¿—
docker-compose logs -f backend
```

### 2. æŸ¥çœ‹ç‰¹å®šå®¹å™¨çš„æ—¥å¿—
```bash
# é¦–å…ˆæŸ¥çœ‹å®¹å™¨ ID æˆ–åç§°
docker ps

# ç„¶åæŸ¥çœ‹ç‰¹å®šå®¹å™¨çš„å®æ—¶æ—¥å¿—
docker logs -f <container_id>
# ä¾‹å¦‚ï¼š
docker logs -f data_agent-backend-1
```

### 3. æŸ¥çœ‹æœ€è¿‘ 100 è¡Œæ—¥å¿—å¹¶æŒç»­è·Ÿè¸ª
```bash
docker logs -f --tail 100 <container_id>
```

### 4. æŸ¥çœ‹å¸¦æ—¶é—´æˆ³çš„æ—¥å¿—
```bash
docker logs -f --timestamps <container_id>
```

### 5. æœç´¢å…³é”®é”™è¯¯ä¿¡æ¯
```bash
# æœç´¢åŒ…å« "CRITICAL" æˆ– "ERROR" çš„æ—¥å¿—
docker logs <container_id> 2>&1 | grep -i "critical\|error\|timeout\|83"

# æˆ–è€…å®æ—¶æœç´¢
docker logs -f <container_id> 2>&1 | grep -i "critical\|error\|timeout"
```

---

## æ–¹æ³•äºŒï¼šæœ¬åœ°å¼€å‘ç¯å¢ƒæŸ¥çœ‹æ—¥å¿—

### 1. æŸ¥çœ‹åç«¯æœåŠ¡æ§åˆ¶å°è¾“å‡º

**Windows:**
```bash
# ä½¿ç”¨å¯åŠ¨è„šæœ¬
scripts\start-backend-local.bat

# æˆ–è€…æ‰‹åŠ¨å¯åŠ¨
cd backend
venv\Scripts\activate
# ğŸ”¥ Token Expansion: å¢åŠ  --timeout-keep-alive åˆ° 300 ç§’ä»¥æ”¯æŒé•¿æ–‡æœ¬ç”Ÿæˆ
uvicorn src.app.main:app --reload --host 0.0.0.0 --port 8004 --timeout-keep-alive 300
```

**Linux/Mac:**
```bash
# ä½¿ç”¨å¯åŠ¨è„šæœ¬
./scripts/start-backend-local.sh

# æˆ–è€…æ‰‹åŠ¨å¯åŠ¨
cd backend
source venv/bin/activate
# ğŸ”¥ Token Expansion: å¢åŠ  --timeout-keep-alive åˆ° 300 ç§’ä»¥æ”¯æŒé•¿æ–‡æœ¬ç”Ÿæˆ
uvicorn src.app.main:app --reload --host 0.0.0.0 --port 8004 --timeout-keep-alive 300
```

### 2. æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶

æ—¥å¿—æ–‡ä»¶ä¿å­˜åœ¨ `backend/logs/` ç›®å½•ï¼š

```bash
# Windows PowerShell
Get-Content backend\logs\app.log -Wait -Tail 50

# Linux/Mac
tail -f backend/logs/app.log

# æˆ–è€…æŸ¥çœ‹é”™è¯¯æ—¥å¿—
tail -f backend/logs/error.log
```

### 3. æœç´¢å…³é”®ä¿¡æ¯

**Windows PowerShell:**
```powershell
# æœç´¢åŒ…å« "CRITICAL" æˆ– "ERROR" çš„è¡Œ
Select-String -Path "backend\logs\app.log" -Pattern "CRITICAL|ERROR|timeout|83" -Context 5

# å®æ—¶æœç´¢
Get-Content backend\logs\app.log -Wait | Select-String -Pattern "CRITICAL|ERROR|timeout"
```

**Linux/Mac:**
```bash
# æœç´¢å…³é”®é”™è¯¯
grep -i "critical\|error\|timeout\|83" backend/logs/app.log

# å®æ—¶æœç´¢
tail -f backend/logs/app.log | grep -i "critical\|error\|timeout"
```

---

## æ–¹æ³•ä¸‰ï¼šæŸ¥çœ‹ç‰¹å®šæ—¶é—´æ®µçš„æ—¥å¿—

### 1. æŸ¥çœ‹æœ€è¿‘ 10 åˆ†é’Ÿçš„æ—¥å¿—

**Docker:**
```bash
docker logs --since 10m <container_id>
```

**æœ¬åœ°æ–‡ä»¶:**
```bash
# éœ€è¦æ ¹æ®æ—¥å¿—æ ¼å¼è°ƒæ•´æ—¶é—´è¿‡æ»¤
tail -n 1000 backend/logs/app.log | grep "$(date -d '10 minutes ago' '+%Y-%m-%d %H:%M')"
```

### 2. æŸ¥çœ‹ç‰¹å®šæ—¶é—´èŒƒå›´çš„æ—¥å¿—

**Docker:**
```bash
# æŸ¥çœ‹ä»æŸä¸ªæ—¶é—´ç‚¹å¼€å§‹çš„æ—¥å¿—
docker logs --since "2025-12-16T21:00:00" <container_id>
```

---

## ğŸ” å…³é”®æ—¥å¿—æ ‡è®°

æ ¹æ®ä»£ç ä¸­çš„æ—¥å¿—æ ‡è®°ï¼ŒæŸ¥æ‰¾ä»¥ä¸‹å…³é”®ä¿¡æ¯ï¼š

### 1. SQL æå–ç›¸å…³æ—¥å¿—
```
âœ… ä»æ–‡æœ¬å†…å®¹ä¸­æå–åˆ° SQL
âš ï¸ æ— æ³•ä» tool_calls æˆ–æ–‡æœ¬å†…å®¹ä¸­æå– SQL
```

### 2. è¶…æ—¶ç›¸å…³æ—¥å¿—
```
timeout
Connection timeout
Read timeout
83  # 83ç§’çš„æ‰§è¡Œæ—¶é—´
```

### 3. å·¥å…·è°ƒç”¨ç›¸å…³æ—¥å¿—
```
Tool execution failed
Tool async execution failed
MCP tool loaded
```

### 4. Agent æ‰§è¡Œç›¸å…³æ—¥å¿—
```
Agent execution failed
Agent stream execution failed
ExceptionGroup detected
TaskGroup error
```

### 5. LLM è°ƒç”¨ç›¸å…³æ—¥å¿—
```
ğŸ”¥ğŸ”¥ FINAL LLM OUTPUT
ğŸ”¥ğŸ”¥ FINAL CONTENT BEFORE PARSING
ğŸ”¥ğŸ”¥ CHART PATTERN MATCHED
ğŸ”¥ğŸ”¥ CHART PATTERN NOT FOUND
```

---

## ğŸš¨ è¯Šæ–­ 83 ç§’å»¶è¿Ÿé—®é¢˜

### æ­¥éª¤ 1ï¼šç¡®è®¤å»¶è¿Ÿå‘ç”Ÿçš„ä½ç½®

åœ¨æ—¥å¿—ä¸­æœç´¢ä»¥ä¸‹æ¨¡å¼ï¼š

```bash
# æœç´¢å¤„ç†æ—¶é—´
grep -i "processing_time\|execution_time\|è€—æ—¶\|83" backend/logs/app.log

# æœç´¢è¶…æ—¶é”™è¯¯
grep -i "timeout\|timed out\|connection.*refused" backend/logs/app.log
```

### æ­¥éª¤ 2ï¼šæ£€æŸ¥ LLM è°ƒç”¨æ—¶é—´

```bash
# æœç´¢ LLM è°ƒç”¨ç›¸å…³çš„æ—¥å¿—
grep -i "llm\|chatopenai\|ainvoke\|response" backend/logs/app.log | tail -20
```

### æ­¥éª¤ 3ï¼šæ£€æŸ¥æ•°æ®åº“è¿æ¥

```bash
# æœç´¢æ•°æ®åº“ç›¸å…³é”™è¯¯
grep -i "database\|postgres\|connection\|query.*failed" backend/logs/app.log | tail -20
```

### æ­¥éª¤ 4ï¼šæ£€æŸ¥ MCP å·¥å…·è°ƒç”¨

```bash
# æœç´¢ MCP ç›¸å…³æ—¥å¿—
grep -i "mcp\|tool.*call\|execute_sql" backend/logs/app.log | tail -20
```

---

## ğŸ“Š å®æ—¶ç›‘æ§å‘½ä»¤ï¼ˆæ¨èï¼‰

### Docker ç¯å¢ƒå®Œæ•´ç›‘æ§å‘½ä»¤

```bash
# åˆ›å»ºä¸€ä¸ªç›‘æ§è„šæœ¬
cat > monitor-backend.sh << 'EOF'
#!/bin/bash
echo "=== ç›‘æ§åç«¯æœåŠ¡æ—¥å¿— ==="
echo "æŒ‰ Ctrl+C åœæ­¢ç›‘æ§"
echo ""
docker logs -f --tail 50 --timestamps backend 2>&1 | \
  grep --line-buffered -E "CRITICAL|ERROR|WARNING|timeout|83|ğŸ”¥ğŸ”¥|SQL|tool.*call" \
  --color=always
EOF

chmod +x monitor-backend.sh
./monitor-backend.sh
```

### Windows PowerShell ç›‘æ§è„šæœ¬

```powershell
# åˆ›å»º monitor-backend.ps1
@"
Write-Host "=== ç›‘æ§åç«¯æœåŠ¡æ—¥å¿— ===" -ForegroundColor Green
Write-Host "æŒ‰ Ctrl+C åœæ­¢ç›‘æ§" -ForegroundColor Yellow
Write-Host ""

docker logs -f --tail 50 --timestamps backend 2>&1 | 
  Select-String -Pattern "CRITICAL|ERROR|WARNING|timeout|83|ğŸ”¥ğŸ”¥|SQL|tool.*call" |
  ForEach-Object { Write-Host $_ }
"@ | Out-File -FilePath monitor-backend.ps1 -Encoding UTF8

# è¿è¡Œç›‘æ§
.\monitor-backend.ps1
```

---

## ğŸ¯ å¿«é€Ÿè¯Šæ–­æ¸…å•

å½“é‡åˆ° 83 ç§’å»¶è¿Ÿæ—¶ï¼ŒæŒ‰ä»¥ä¸‹é¡ºåºæ£€æŸ¥ï¼š

1. âœ… **æ£€æŸ¥ LLM è°ƒç”¨æ˜¯å¦è¶…æ—¶**
   ```bash
   grep -i "timeout\|chatopenai\|ainvoke" backend/logs/app.log | tail -10
   ```

2. âœ… **æ£€æŸ¥ SQL æ˜¯å¦æˆåŠŸæå–**
   ```bash
   grep -i "ä»æ–‡æœ¬å†…å®¹ä¸­æå–åˆ° SQL\|æ— æ³•ä» tool_calls" backend/logs/app.log | tail -5
   ```

3. âœ… **æ£€æŸ¥å·¥å…·è°ƒç”¨æ˜¯å¦å¤±è´¥**
   ```bash
   grep -i "tool.*execution.*failed\|mcp.*error" backend/logs/app.log | tail -10
   ```

4. âœ… **æ£€æŸ¥æ•°æ®åº“è¿æ¥**
   ```bash
   grep -i "database.*connection\|postgres.*error" backend/logs/app.log | tail -10
   ```

5. âœ… **æ£€æŸ¥å¼‚å¸¸å †æ ˆ**
   ```bash
   grep -A 20 "ExceptionGroup\|TaskGroup\|Traceback" backend/logs/app.log | tail -30
   ```

---

## ğŸ’¡ æç¤º

- **å®æ—¶ç›‘æ§**ï¼šä½¿ç”¨ `-f` å‚æ•°å®æ—¶è·Ÿè¸ªæ—¥å¿—
- **è¿‡æ»¤è¾“å‡º**ï¼šä½¿ç”¨ `grep` è¿‡æ»¤å…³é”®ä¿¡æ¯ï¼Œé¿å…æ—¥å¿—è¿‡å¤š
- **æ—¶é—´æˆ³**ï¼šä½¿ç”¨ `--timestamps` æŸ¥çœ‹ç²¾ç¡®æ—¶é—´ï¼Œå¸®åŠ©å®šä½é—®é¢˜
- **ä¸Šä¸‹æ–‡**ï¼šä½¿ç”¨ `-A` å’Œ `-B` å‚æ•°æŸ¥çœ‹é”™è¯¯å‰åçš„ä¸Šä¸‹æ–‡

---

## ğŸ“ æ—¥å¿—æ–‡ä»¶ä½ç½®æ€»ç»“

| ç¯å¢ƒ | æ—¥å¿—ä½ç½® | æŸ¥çœ‹å‘½ä»¤ |
|------|---------|---------|
| Docker | `docker logs <container>` | `docker logs -f backend` |
| æœ¬åœ°å¼€å‘ | `backend/logs/app.log` | `tail -f backend/logs/app.log` |
| é”™è¯¯æ—¥å¿— | `backend/logs/error.log` | `tail -f backend/logs/error.log` |

---

**éœ€è¦å¸®åŠ©ï¼Ÿ** å¦‚æœä»ç„¶æ— æ³•å®šä½é—®é¢˜ï¼Œè¯·æä¾›ï¼š
1. å®Œæ•´çš„é”™è¯¯æ—¥å¿—ï¼ˆåŒ…å«æ—¶é—´æˆ³ï¼‰
2. 83 ç§’å»¶è¿Ÿå‘ç”Ÿæ—¶çš„å®Œæ•´è¯·æ±‚ä¿¡æ¯
3. ç›¸å…³çš„ CRITICAL æˆ– ERROR çº§åˆ«æ—¥å¿—

