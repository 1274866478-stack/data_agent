# Data Agent V4 - 第8部分：统一项目结构

## 完整目录结构

```
/Data-Agent-V4/
├── backend/
│   ├── src/
│   │   ├── app/
│   │   │   ├── api/
│   │   │   │   ├── deps.py       # (V4 更新) JWT 租户验证
│   │   │   │   └── v1/
│   │   │   │       ├── router.py
│   │   │   │       ├── query.py    # (V4 更新) 租户隔离的 /query
│   │   │   │       └── data_source.py # (V4 新增) /data-sources/* 路由
│   │   │   ├── core/
│   │   │   ├── services/         # (V4 更新) 租户隔离的 Agentic Core
│   │   │   ├── data/           # (V4 更新) PostgreSQL 和 ChromaDB
│   │   │   ├── schemas.py      # (V4 更新) 包含租户模式
│   │   │   └── main.py
│   ├── .env                    # (V4 更新) 包含 ZHIPUAI_API_KEY, DB_URL, MINIO_KEY
│   ├── Dockerfile              # (V4 新增) Docker 容器配置
│   └── requirements.txt        # (V4 更新) 包含 zhipuai, psycopg2, minio
├── frontend/
│   ├── src/
│   │   ├── app/
│   │   │   ├── (auth)/         # (V4 新增) 登录路由
│   │   │   ├── (app)/          # (V4 新增) 受保护路由
│   │   │   │   ├── page.tsx      # (V3 保留) 聊天界面
│   │   │   │   └── data-sources/ # (V4 新增) 数据源管理
│   │   │   └── layout.tsx    # (V4 更新) 包含 Auth Provider
│   ├── .env.local            # (V4 更新) 包含 Clerk/Auth0 密钥
│   └── Dockerfile              # (V4 新增) Docker 容器配置
├── docs/
│   ├── prd-v4.md           # (PRD V4)
│   ├── architecture-v4.md  # (本文档)
│   └── style.md            # (UI 规范)
├── docker-compose.yml        # (V4 新增) 编排 (frontend, backend, db, storage, vector_db)
└── README.md                 # (V4 更新) 包含 `docker compose up` 说明
```

## V4 关键文件变更

### 后端新增/更新文件

1. **deps.py**: JWT 认证中间件
2. **data_source.py**: 数据源管理 API
3. **schemas.py**: 租户数据模型
4. **Dockerfile**: 后端容器化配置
5. **requirements.txt**: 更新依赖包

### 前端新增/更新文件

1. **(auth)/ 路由组**: 登录注册页面
2. **(app)/ 路由组**: 受保护的应用页面
3. **data-sources/**: 数据源管理界面
4. **layout.tsx**: 集成认证提供商
5. **Dockerfile**: 前端容器化配置

### 根目录新增文件

1. **docker-compose.yml**: 服务编排配置
2. **README.md**: Docker Compose 启动指南

## 环境配置

### 后端 .env
```
ZHIPUAI_API_KEY=your_zhipu_key
DB_URL=postgresql://postgres:password@db:5432/dataagent
MINIO_ENDPOINT=minio
MINIO_ACCESS_KEY=minioadmin
MINIO_SECRET_KEY=minioadmin
CLERK_JWT_PUBLIC_KEY=your_clerk_public_key
```

### 前端 .env.local
```
NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY=your_clerk_publishable_key
CLERK_SECRET_KEY=your_clerk_secret_key
NEXT_PUBLIC_API_URL=http://localhost:8004/api/v1
```

---
**分片索引**: 08-项目结构.md | **总页数**: 8/17