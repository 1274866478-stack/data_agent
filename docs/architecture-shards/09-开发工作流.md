# Data Agent V4 - 第9部分：开发工作流

## Local Development Setup (本地开发设置)

### Initial Setup (初次安装)

```bash
# 1. 克隆仓库
git clone [REPO_URL] && cd Data-Agent-V4/

# 2. 复制 .env 模板
cp backend/.env.example backend/.env
cp frontend/.env.local.example frontend/.env.local

# 3. 填入你的 ZHIPUAI_API_KEY 和 Clerk/Auth0 密钥
# 编辑上述文件，填入相应的 API 密钥

# 4. (V4 升级) 启动整个 SaaS 环境
docker compose up --build
```

## 开发环境要求

### 系统要求
- Docker Desktop (Windows)
- Node.js 18+ (本地开发时)
- Python 3.11+ (本地开发时)

### 开发工具
- IDE: VS Code (推荐)
- 数据库管理: pgAdmin (PostgreSQL)
- 对象存储管理: MinIO Console

## 开发流程

### 1. 功能开发流程
1. 从 `develop` 分支创建功能分支
2. 实现功能代码
3. 编写测试用例
4. 提交代码审查
5. 合并到 `develop` 分支

### 2. 测试流程
```bash
# 后端测试
cd backend
pytest tests/

# 前端测试
cd frontend
npm run test

# 集成测试
docker compose -f docker-compose.test.yml up
```

### 3. 代码质量检查
```bash
# 后端代码格式化
cd backend
black src/
isort src/
flake8 src/

# 前端代码格式化
cd frontend
npm run format
npm run lint
```

## 本地调试

### 后端调试
```bash
# 直接运行后端 (绕过 Docker)
cd backend
python -m uvicorn src.app.main:app --reload --host 0.0.0.0 --port 8000
```

### 前端调试
```bash
# 直接运行前端 (绕过 Docker)
cd frontend
npm run dev
```

### 数据库调试
```bash
# 连接到 PostgreSQL 容器
docker exec -it data-agent-db psql -U postgres -d dataagent
```

## 环境变量管理

### 敏感信息
- 所有 API 密钥不得提交到代码仓库
- 使用 `.env.example` 作为模板
- 在 CI/CD 中使用环境变量管理

### 配置验证
启动时验证所有必需的环境变量：
```python
# backend/src/app/core/config.py
def validate_config():
    required_vars = ["ZHIPUAI_API_KEY", "DB_URL", "CLERK_JWT_PUBLIC_KEY"]
    for var in required_vars:
        if not getattr(settings, var):
            raise ValueError(f"Missing required environment variable: {var}")
```

---
**分片索引**: 09-开发工作流.md | **总页数**: 9/17