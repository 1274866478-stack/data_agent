# Data Agent V4 - 第6部分：前端架构

## V4 变更概述

frontend/src/app/ 文件夹将包含新的受保护路由和公共路由。

## 目录结构

```
frontend/src/app/
├── (auth)/         # (V4 新增) 公共路由 (登录/注册)
│   ├── sign-in/
│   └── sign-up/
├── (app)/          # (V4 新增) 受保护的租户应用
│   ├── layout.tsx    # (V4) 包含 Auth Provider 和 style.md 布局
│   ├── page.tsx      # (V3 保留) 聊天界面
│   └── data-sources/ # (V4 新增) 数据源管理
├── components/
└── lib/
    ├── api.ts        # (V4 更新) 必须使用 Auth JWT
    └── store.ts      # (V3 保留)
```

## 关键变更

### 1. 认证路由 (V4 新增)
- `(auth)/` 目录包含公开的登录/注册页面
- 未认证用户将被重定向到此路由组

### 2. 受保护路由 (V4 新增)
- `(app)/` 目录需要认证才能访问
- 包含主要的应用功能

### 3. API 客户端更新

lib/api.ts 必须被重构，以使用托管认证服务：

```typescript
// 使用认证钩子获取动态 JWT Token
const { getToken } = useAuth();
const token = await getToken();

// API 调用必须包含 JWT
const response = await fetch('/api/v1/query', {
  method: 'POST',
  headers: {
    'Authorization': `Bearer ${token}`,
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({ question })
});
```

## 界面屏幕

### 屏幕 1 (V4 新增): 登录界面
- Clerk / Auth0 提供的认证界面
- 支持邮箱/密码和社交登录

### 屏幕 2 (V4 新增): 数据源管理
- 数据库连接配置页面
- 文档上传和管理界面

### 屏幕 3 (V3 保留): 主查询/聊天界面
- 保留原有的聊天交互体验
- 集成租户数据源

---
**分片索引**: 06-前端架构.md | **总页数**: 6/17