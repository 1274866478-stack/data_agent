# Data Agent V4 - 第2部分：高层架构

## 技术摘要

本架构是一个云就绪 (Cloud-Ready)、多租户 (Multi-Tenant) 的全栈应用，通过 Docker Compose 在本地运行。

### 核心组件
- **前端**: Next.js ("the curator." 风格)
- **后端**: FastAPI
- **认证**: 托管认证服务（如 Clerk）
- **AI引擎**: Agentic Core 使用 Zhipu GLM API
- **数据库**: 租户隔离的 PostgreSQL
- **存储**: MinIO 对象存储

## 平台与基础设施选择

### 平台 (MVP)
Docker Compose

### 理由
满足 PRD V4 NFR1 和 NFR2 的要求，在本地模拟云微服务环境，确保未来可以平滑迁移到云服务器。

## 关键服务 (Docker Compose)

1. **frontend** (Next.js)
2. **backend** (FastAPI)
3. **db** (PostgreSQL)
4. **storage** (MinIO)
5. **vector_db** (ChromaDB)

## 代码仓库结构

**结构**: Monorepo (单一仓库)（由 docker-compose.yml 在根目录编排）

## 高层架构图

```
用户 (浏览器)
    ↓ 登录
认证 (Clerk/Auth0)
    ↓ JWT (含 tenant_id)
前端 (Next.js)
    ↓ POST /api/v1/query (JWT)
后端 (FastAPI)
    ↓ tenant_id, question
Agentic Core
    ├── RAG-SQL 链 → PostgreSQL (租户数据)
    ├── RAG 链 → ChromaDB → MinIO
    └── XAI 融合
    ↓ 融合答案 + XAI Log
外部 API (Zhipu GLM API)
```

## 架构模式

1. **多租户 SaaS**: 认证和数据访问必须与租户 ID 绑定
2. **自带数据 (BYO-Data)**: 系统存储连接字符串并远程查询
3. **Agentic RAG-SQL**: 保留自我修正和 XAI 逻辑
4. **云就绪**: 使用 Docker Compose 确保本地 MVP 与生产环境一致

---
**分片索引**: 02-高层架构.md | **总页数**: 2/17