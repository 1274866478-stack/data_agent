# Data Agent V4 - 第4部分：数据模型

V4 数据模型（存储在 Docker PostgreSQL 中）必须支持多租户。

## 数据模型 1: Tenant (V4 新增)

**用途**: 存储租户（组织/用户）信息。

### TypeScript 接口 (共享)

```typescript
export interface Tenant {
  id: string; // (来自 Clerk/Auth0 的 User/Org ID)
  email: string;
  createdAt: string;
}
```

## 数据模型 2: DataSourceConnection (V4 新增)

**用途**: 安全地存储用户导入的数据库连接字符串。

### TypeScript 接口 (共享)

```typescript
export interface DataSourceConnection {
  id: string;
  tenant_id: string; // (外键 -> Tenant.id)
  db_type: 'postgresql'; // MVP 仅支持 PG
  connection_string: string; // (必须在数据库中加密存储)
  name: string;
  createdAt: string;
}
```

## 数据模型 3: KnowledgeDocument (V4 新增)

**用途**: 跟踪用户上传的文档。

### TypeScript 接口 (共享)

```typescript
export interface KnowledgeDocument {
  id: string;
  tenant_id: string; // (外键 -> Tenant.id)
  file_name: string; // (例如 'annual_report.pdf')
  storage_path: string; // (例如 'tenant-abc/annual_report.pdf')
  status: 'PENDING' | 'INDEXING' | 'READY';
  createdAt: string;
}
```

## 数据模型 4: KnowledgeCitation (V3 修改版)

**用途**: API 响应中的溯源格式。

### TypeScript 接口 (共享)

```typescript
export interface KnowledgeCitation {
  source_type: 'database' | 'pdf' | 'docx'; // (V4 MVP 降级：移除图表表格支持)
  file_name: string; // (例如 'product_sales' 或 'annual_report.pdf')
  page_number?: number;
}
```

## 租户隔离要求

所有数据模型都包含 `tenant_id` 字段，确保：
1. 数据访问权限严格按租户隔离
2. 查询必须包含 WHERE tenant_id = '...' 子句
3. 外键关系确保数据完整性

---
**分片索引**: 04-数据模型.md | **总页数**: 4/17