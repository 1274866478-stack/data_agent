# ğŸš€ Story-2.4 æ–‡æ¡£ä¸Šä¼ å’Œç®¡ç† - ä¿®å¤æ‰§è¡Œè®¡åˆ’

**åˆ›å»ºæ—¥æœŸ:** 2025-11-17
**åˆ›å»ºäººå‘˜:** Quinn - æµ‹è¯•æ¶æ„å¸ˆä¸è´¨é‡é¡¾é—®
**è®¡åˆ’ç±»å‹:** ç´§æ€¥ä¿®å¤æ‰§è¡Œè®¡åˆ’
**ä¼˜å…ˆçº§:** P0 - é˜»å¡æ€§é—®é¢˜ä¿®å¤

## ğŸ“Š è®¡åˆ’æ¦‚è¿°

**ä¿®å¤ç›®æ ‡:** å°†Story-2.4ä»FAILçŠ¶æ€ä¿®å¤åˆ°PASSçŠ¶æ€
**é¢„è®¡å·¥æœŸ:** 8-10ä¸ªå·¥ä½œæ—¥
**æ¶‰åŠå›¢é˜Ÿ:** å…¨æ ˆå¼€å‘ã€æµ‹è¯•ã€DevOps
**é£é™©ç­‰çº§:** é«˜ - éœ€è¦é‡æ„æ ¸å¿ƒç»„ä»¶

## ğŸ¯ ä¿®å¤ç­–ç•¥

### é˜¶æ®µæ€§ä¿®å¤æ–¹æ³•
1. **æ•°æ®ä¼˜å…ˆ** - å…ˆé‡æ„æ•°æ®æ¨¡å‹ï¼Œå»ºç«‹æ­£ç¡®åŸºç¡€
2. **åç«¯é©±åŠ¨** - å®Œå–„æœåŠ¡å±‚å’ŒAPIï¼Œç¡®ä¿ä¸šåŠ¡é€»è¾‘æ­£ç¡®
3. **ç”¨æˆ·å¯¼å‘** - å¼€å‘å‰ç«¯ç»„ä»¶ï¼Œå®ç°å®Œæ•´ç”¨æˆ·åŠŸèƒ½
4. **è´¨é‡ä¿è¯** - å…¨ç¨‹æµ‹è¯•è¦†ç›–ï¼Œç¡®ä¿ä¿®å¤è´¨é‡

### ä¿®å¤åŸåˆ™
- ä¸¥æ ¼éµå¾ªStoryè§„èŒƒè¦æ±‚
- ä¿æŒå‘åå…¼å®¹æ€§ï¼ˆå¦‚æœ‰å¯èƒ½ï¼‰
- å®æ–½æµ‹è¯•é©±åŠ¨å¼€å‘(TDD)
- æŒç»­é›†æˆå’ŒéªŒè¯

## ğŸ“‹ è¯¦ç»†ä¿®å¤è®¡åˆ’

### ğŸ”§ é˜¶æ®µä¸€: æ•°æ®æ¨¡å‹é‡æ„ (Day 1-2)

#### 1.1 æ•°æ®åº“æ¨¡å‹åˆ†æ
**å½“å‰é—®é¢˜:**
- idå­—æ®µä¸ºIntegerè€ŒéUUID
- å­—æ®µå‘½åä¸ç¬¦åˆStoryè§„èŒƒ
- çŠ¶æ€æšä¸¾å€¼é”™è¯¯
- ç¼ºå¤±å¿…è¦å­—æ®µ

**ä¿®å¤ä»»åŠ¡:**
```sql
-- éœ€è¦æ‰§è¡Œçš„æ•°æ®åº“å˜æ›´
1. åˆ›å»ºæ–°è¡¨ knowledge_documents_v2
2. è¿ç§»ç°æœ‰æ•°æ®åˆ°æ–°è¡¨ç»“æ„
3. æ›´æ–°æ‰€æœ‰å¤–é”®å¼•ç”¨
4. åˆ é™¤æ—§è¡¨å¹¶é‡å‘½åæ–°è¡¨
```

#### 1.2 æ¨¡å‹é‡æ„ä»»åŠ¡æ¸…å•
- [ ] **1.2.1** é‡æ„KnowledgeDocumentæ¨¡å‹
  - å°†idå­—æ®µæ”¹ä¸ºUUIDç±»å‹
  - é‡å‘½åfile_pathä¸ºstorage_path
  - æ›´æ–°processing_statusä¸ºç¬¦åˆStoryçš„ENUM
  - æ·»åŠ indexed_atå­—æ®µ
  - æ·»åŠ processing_errorå­—æ®µ

- [ ] **1.2.2** åˆ›å»ºæ•°æ®åº“è¿ç§»è„šæœ¬
  ```sql
  -- æ–‡ä»¶: backend/migrations/003_fix_document_model.sql
  -- åŒ…å«å®Œæ•´çš„è¿ç§»é€»è¾‘
  ```

- [ ] **1.2.3** æ›´æ–°ç›¸å…³æ¨¡å‹å¼•ç”¨
  - æ›´æ–°Tenantæ¨¡å‹ä¸­çš„relationship
  - æ›´æ–°æ‰€æœ‰ä¾èµ–knowledge_documentsçš„æŸ¥è¯¢

#### 1.3 éªŒæ”¶æ ‡å‡†
- âœ… æ•°æ®æ¨¡å‹å®Œå…¨ç¬¦åˆStoryè§„èŒƒ
- âœ… æ•°æ®è¿ç§»æˆåŠŸï¼Œæ— æ•°æ®ä¸¢å¤±
- âœ… æ‰€æœ‰å¤–é”®å…³ç³»æ­£ç¡®
- âœ… æ•°æ®åº“æ€§èƒ½æµ‹è¯•é€šè¿‡

### ğŸ”§ é˜¶æ®µäºŒ: åç«¯æœåŠ¡å±‚å¼€å‘ (Day 3-4)

#### 2.1 æœåŠ¡æ¶æ„è®¾è®¡
**ç¼ºå¤±æœåŠ¡:**
- DocumentService - æ–‡æ¡£ç®¡ç†æ ¸å¿ƒæœåŠ¡
- DocumentProcessor - æ–‡æ¡£å¤„ç†æœåŠ¡

#### 2.2 æœåŠ¡å¼€å‘ä»»åŠ¡æ¸…å•

- [ ] **2.2.1** åˆ›å»ºDocumentService
  ```python
  # æ–‡ä»¶: backend/src/app/services/document_service.py
  # åŠŸèƒ½: æ–‡æ¡£CRUDã€çŠ¶æ€ç®¡ç†ã€ç§Ÿæˆ·éš”ç¦»
  - upload_document()
  - get_documents()
  - get_document_by_id()
  - update_document_status()
  - delete_document()
  - get_document_preview_url()
  ```

- [ ] **2.2.2** åˆ›å»ºDocumentProcessor
  ```python
  # æ–‡ä»¶: backend/src/app/services/document_processor.py
  # åŠŸèƒ½: æ–‡æ¡£è§£æã€æ–‡æœ¬æå–ã€çŠ¶æ€æ›´æ–°
  - process_document()
  - extract_text_from_pdf()
  - extract_text_from_docx()
  - update_processing_status()
  - handle_processing_error()
  ```

- [ ] **2.2.3** æ›´æ–°MinIOService
  ```python
  # å¢å¼º: backend/src/app/services/minio_client.py
  - æ·»åŠ generate_preview_url()æ–¹æ³•
  - ä¼˜åŒ–å­˜å‚¨è·¯å¾„ç”Ÿæˆé€»è¾‘
  - æ·»åŠ æ–‡ä»¶æ¸…ç†åŠŸèƒ½
  ```

#### 2.3 APIç«¯ç‚¹å®Œå–„
- [ ] **2.3.1** æ›´æ–°documents.py API
  - ä¿®å¤æ•°æ®æ¨¡å‹å¼•ç”¨
  - é›†æˆDocumentService
  - æ·»åŠ æ–‡æ¡£é¢„è§ˆç«¯ç‚¹
  - å®Œå–„é”™è¯¯å¤„ç†

- [ ] **2.3.2** æ·»åŠ ç¼ºå¤±ç«¯ç‚¹
  ```python
  # GET /api/v1/documents/{id}/preview
  # PUT /api/v1/documents/{id}/status
  # GET /api/v1/documents/stats
  ```

#### 2.4 éªŒæ”¶æ ‡å‡†
- âœ… æ‰€æœ‰æœåŠ¡å±‚åŠŸèƒ½å®Œæ•´å®ç°
- âœ… APIç«¯ç‚¹ç¬¦åˆStoryè§„èŒƒ
- âœ… æœåŠ¡å±‚å•å…ƒæµ‹è¯•è¦†ç›–ç‡ > 80%
- âœ… APIé›†æˆæµ‹è¯•é€šè¿‡

### ğŸ”§ é˜¶æ®µä¸‰: å‰ç«¯ç»„ä»¶å¼€å‘ (Day 5-7)

#### 3.1 å‰ç«¯æ¶æ„è§„åˆ’
**ç»„ä»¶å±‚æ¬¡ç»“æ„:**
```
documents/page.tsx (é¡µé¢å®¹å™¨)
â”œâ”€â”€ DocumentUpload.tsx (ä¸Šä¼ ç»„ä»¶)
â”œâ”€â”€ DocumentList.tsx (åˆ—è¡¨å®¹å™¨)
â”‚   â””â”€â”€ DocumentCard.tsx (å¡ç‰‡ç»„ä»¶)
â”œâ”€â”€ DocumentPreview.tsx (é¢„è§ˆç»„ä»¶)
â””â”€â”€ documentStore.ts (çŠ¶æ€ç®¡ç†)
```

#### 3.2 ç»„ä»¶å¼€å‘ä»»åŠ¡æ¸…å•

- [ ] **3.2.1** çŠ¶æ€ç®¡ç†å®ç°
  ```typescript
  // æ–‡ä»¶: frontend/src/store/documentStore.ts
  // åŠŸèƒ½: æ–‡æ¡£çŠ¶æ€ç®¡ç†ã€APIè°ƒç”¨ã€ç¼“å­˜
  interface DocumentStore {
    documents: KnowledgeDocument[]
    uploadProgress: Record<string, number>
    isLoading: boolean
    error: string | null
    selectedDocuments: string[]

    // Actions
    fetchDocuments(): Promise<void>
    uploadDocument(file: File): Promise<void>
    deleteDocument(id: string): Promise<void>
    getDocumentPreview(id: string): Promise<string>
  }
  ```

- [ ] **3.2.2** DocumentUploadç»„ä»¶
  ```typescript
  // æ–‡ä»¶: frontend/src/components/documents/DocumentUpload.tsx
  // åŠŸèƒ½: æ‹–æ‹½ä¸Šä¼ ã€æ–‡ä»¶éªŒè¯ã€è¿›åº¦æ˜¾ç¤ºã€æ‰¹é‡ä¸Šä¼ 
  ```

- [ ] **3.2.3** DocumentListç»„ä»¶
  ```typescript
  // æ–‡ä»¶: frontend/src/components/documents/DocumentList.tsx
  // åŠŸèƒ½: æ–‡æ¡£åˆ—è¡¨ã€æœç´¢è¿‡æ»¤ã€æ‰¹é‡æ“ä½œã€çŠ¶æ€æ˜¾ç¤º
  ```

- [ ] **3.2.4** DocumentCardç»„ä»¶
  ```typescript
  // æ–‡ä»¶: frontend/src/components/documents/DocumentCard.tsx
  // åŠŸèƒ½: æ–‡æ¡£ä¿¡æ¯å±•ç¤ºã€å¿«é€Ÿæ“ä½œã€çŠ¶æ€æŒ‡ç¤ºå™¨
  ```

- [ ] **3.2.5** DocumentPreviewç»„ä»¶
  ```typescript
  // æ–‡ä»¶: frontend/src/components/documents/DocumentPreview.tsx
  // åŠŸèƒ½: PDF/Wordé¢„è§ˆã€ç¼©æ”¾æ§åˆ¶ã€ä¸‹è½½åŠŸèƒ½
  ```

- [ ] **3.2.6** æ–‡æ¡£ç®¡ç†é¡µé¢
  ```typescript
  // æ–‡ä»¶: frontend/src/app/(app)/documents/page.tsx
  // åŠŸèƒ½: é¡µé¢å¸ƒå±€ã€ç»„ä»¶é›†æˆã€ç»Ÿè®¡ä¿¡æ¯
  ```

#### 3.3 UIç»„ä»¶éœ€æ±‚
- [ ] **3.3.1** ä¾èµ–UIç»„ä»¶
  - Progress (è¿›åº¦æ¡)
  - Dialog (å¯¹è¯æ¡†)
  - Select (é€‰æ‹©å™¨)
  - Checkbox (å¤é€‰æ¡†)
  - Alert (è­¦å‘Šæç¤º)

#### 3.4 éªŒæ”¶æ ‡å‡†
- âœ… æ‰€æœ‰ç»„ä»¶åŠŸèƒ½å®Œæ•´å®ç°
- âœ… å“åº”å¼è®¾è®¡ï¼Œæ”¯æŒç§»åŠ¨ç«¯
- âœ… ç»„ä»¶å•å…ƒæµ‹è¯•è¦†ç›–ç‡ > 70%
- âœ… E2Eæµ‹è¯•é€šè¿‡
- âœ… ç”¨æˆ·ä½“éªŒæµ‹è¯•é€šè¿‡

### ğŸ”§ é˜¶æ®µå››: æµ‹è¯•å¼€å‘ (Day 8-9)

#### 4.1 æµ‹è¯•ç­–ç•¥
**æµ‹è¯•é‡‘å­—å¡”:**
- å•å…ƒæµ‹è¯•: 70%
- é›†æˆæµ‹è¯•: 20%
- E2Eæµ‹è¯•: 10%

#### 4.2 æµ‹è¯•å¼€å‘ä»»åŠ¡æ¸…å•

- [ ] **4.2.1** åç«¯å•å…ƒæµ‹è¯•
  ```python
  # test_document_service.py
  # test_document_processor.py
  # test_minio_client_enhancements.py
  ```

- [ ] **4.2.2** APIé›†æˆæµ‹è¯•
  ```python
  # test_document_api_integration.py
  # test_document_end_to_end.py
  # test_tenant_isolation.py
  ```

- [ ] **4.2.3** å‰ç«¯ç»„ä»¶æµ‹è¯•
  ```typescript
  // DocumentUpload.test.tsx
  // DocumentList.test.tsx
  // DocumentCard.test.tsx
  // documentStore.test.ts
  ```

- [ ] **4.2.4** E2Eæµ‹è¯•
  ```typescript
  // e2e/document-management.spec.ts
  // å®Œæ•´ç”¨æˆ·æµç¨‹æµ‹è¯•
  ```

#### 4.3 æ€§èƒ½æµ‹è¯•
- [ ] **4.3.1** æ–‡ä»¶ä¸Šä¼ æ€§èƒ½æµ‹è¯•
- [ ] **4.3.2** å¤§æ–‡ä»¶å¤„ç†æµ‹è¯•
- [ ] **4.3.3** å¹¶å‘ç”¨æˆ·æµ‹è¯•
- [ ] **4.3.4** å­˜å‚¨æ€§èƒ½æµ‹è¯•

#### 4.4 éªŒæ”¶æ ‡å‡†
- âœ… æ•´ä½“æµ‹è¯•è¦†ç›–ç‡ > 80%
- âœ… æ‰€æœ‰å…³é”®åŠŸèƒ½æµ‹è¯•é€šè¿‡
- âœ… æ€§èƒ½æŒ‡æ ‡è¾¾æ ‡
- âœ… å®‰å…¨æµ‹è¯•é€šè¿‡

### ğŸ”§ é˜¶æ®µäº”: é›†æˆå’Œä¼˜åŒ– (Day 10)

#### 5.1 ç³»ç»Ÿé›†æˆ
- [ ] **5.1.1** å‰åç«¯é›†æˆæµ‹è¯•
- [ ] **5.1.2** MinIOé›†æˆéªŒè¯
- [ ] **5.1.3** æ•°æ®åº“è¿ç§»æµ‹è¯•
- [ ] **5.1.4** ç§Ÿæˆ·éš”ç¦»éªŒè¯

#### 5.2 æ€§èƒ½ä¼˜åŒ–
- [ ] **5.2.1** æ–‡ä»¶ä¸Šä¼ ä¼˜åŒ–
- [ ] **5.2.2** æŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–
- [ ] **5.2.3** å‰ç«¯æ¸²æŸ“ä¼˜åŒ–
- [ ] **5.2.4** ç¼“å­˜ç­–ç•¥å®æ–½

#### 5.3 æ–‡æ¡£æ›´æ–°
- [ ] **5.3.1** APIæ–‡æ¡£æ›´æ–°
- [ ] **5.3.2** éƒ¨ç½²æŒ‡å—æ›´æ–°
- [ ] **5.3.3** ç”¨æˆ·æ‰‹å†Œæ›´æ–°
- [ ] **5.3.4** å¼€å‘æ–‡æ¡£æ›´æ–°

## ğŸš¨ é£é™©ç®¡ç†

### é«˜é£é™©é¡¹ç›®
1. **æ•°æ®è¿ç§»é£é™©**
   - é£é™©: æ•°æ®ä¸¢å¤±æˆ–æŸå
   - ç¼“è§£: å®Œæ•´å¤‡ä»½ã€åˆ†æ­¥è¿ç§»ã€å›æ»šè®¡åˆ’

2. **å‰ç«¯å¤æ‚æ€§**
   - é£é™©: ç»„ä»¶å¼€å‘æ—¶é—´è¶…é¢„æœŸ
   - ç¼“è§£: ä½¿ç”¨ç°æœ‰UIåº“ã€åˆ†é˜¶æ®µäº¤ä»˜

3. **æ€§èƒ½é—®é¢˜**
   - é£é™©: å¤§æ–‡ä»¶å¤„ç†æ€§èƒ½ä¸è¾¾æ ‡
   - ç¼“è§£: åˆ†ç‰‡ä¸Šä¼ ã€å¼‚æ­¥å¤„ç†

### åº”æ€¥è®¡åˆ’
- **å›æ»šç­–ç•¥:** ä¿ç•™åŸå§‹ä»£ç åˆ†æ”¯
- **é™çº§æ–¹æ¡ˆ:** å…ˆå®ç°æ ¸å¿ƒåŠŸèƒ½ï¼Œé€æ­¥å®Œå–„
- **èµ„æºè°ƒé…:** å‡†å¤‡é¢å¤–å¼€å‘èµ„æº

## ğŸ“Š è´¨é‡æ£€æŸ¥ç‚¹

### æ¯æ—¥æ£€æŸ¥ç‚¹
- **Day 1:** æ•°æ®æ¨¡å‹é‡æ„å®ŒæˆéªŒè¯
- **Day 3:** æœåŠ¡å±‚å¼€å‘å®ŒæˆéªŒè¯
- **Day 6:** å‰ç«¯ç»„ä»¶å¼€å‘å®ŒæˆéªŒè¯
- **Day 9:** æµ‹è¯•è¦†ç›–å®ŒæˆéªŒè¯
- **Day 10:** ç³»ç»Ÿé›†æˆéªŒè¯

### éªŒæ”¶æ ‡å‡†æ£€æŸ¥ç‚¹
- [ ] æ‰€æœ‰8ä¸ªéªŒæ”¶æ ‡å‡†100%æ»¡è¶³
- [ ] æµ‹è¯•è¦†ç›–ç‡ > 80%
- [ ] æ€§èƒ½æŒ‡æ ‡è¾¾æ ‡
- [ ] å®‰å…¨æ£€æŸ¥é€šè¿‡
- [ ] ç”¨æˆ·ä½“éªŒæµ‹è¯•é€šè¿‡

## ğŸ¯ æˆåŠŸæ ‡å‡†

### åŠŸèƒ½å®Œæ•´æ€§
- âœ… æ”¯æŒPDFå’ŒWordæ–‡æ¡£ä¸Šä¼ 
- âœ… MinIOå®‰å…¨å­˜å‚¨
- âœ… æ–‡æ¡£çŠ¶æ€è·Ÿè¸ª (PENDING, INDEXING, READY, ERROR)
- âœ… å®Œæ•´CRUDæ“ä½œAPI
- âœ… å‰ç«¯æ–‡æ¡£ç®¡ç†ç•Œé¢
- âœ… ç§Ÿæˆ·éš”ç¦»å­˜å‚¨
- âœ… æ–‡æ¡£é¢„è§ˆåŠŸèƒ½
- âœ… æ–‡æ¡£åˆ é™¤å’Œæ¸…ç†

### è´¨é‡æ ‡å‡†
- âœ… ä»£ç è¦†ç›–ç‡ > 80%
- âœ… æ€§èƒ½: 10MBæ–‡ä»¶ä¸Šä¼  < 30ç§’
- âœ… ç”¨æˆ·ä½“éªŒ: ç•Œé¢å‹å¥½ï¼Œæ“ä½œç›´è§‚
- âœ… å®‰å…¨æ€§: ä¸¥æ ¼çš„ç§Ÿæˆ·éš”ç¦»
- âœ… å¯ç»´æŠ¤æ€§: æ¸…æ™°çš„ä»£ç ç»“æ„å’Œæ–‡æ¡£

## ğŸ“ è”ç³»å’Œæ²Ÿé€š

### æ¯æ—¥ç«™ä¼š
- **æ—¶é—´:** æ¯å¤©9:30 AM
- **å‚ä¸:** å…¨æ ˆå¼€å‘ã€æµ‹è¯•ã€äº§å“è´Ÿè´£äºº
- **å†…å®¹:** è¿›åº¦åŒæ­¥ã€é£é™©è¯†åˆ«ã€é—®é¢˜è§£å†³

### é—®é¢˜å‡çº§è·¯å¾„
1. **æŠ€æœ¯é—®é¢˜:** â†’ Tech Lead
2. **è¿›åº¦é—®é¢˜:** â†’ Project Manager
3. **è´¨é‡é—®é¢˜:** â†’ QA Team
4. **ç´§æ€¥é—®é¢˜:** â†’ ç«‹å³è”ç³»æ‰€æœ‰ç›¸å…³äººå‘˜

## ğŸ“‹ ä»»åŠ¡åˆ†é…å»ºè®®

### åç«¯å¼€å‘ (40% å·¥ä½œé‡)
- **ä»»åŠ¡:** æ•°æ®æ¨¡å‹é‡æ„ã€æœåŠ¡å±‚å¼€å‘ã€APIå®Œå–„
- **æŠ€èƒ½:** Python, FastAPI, SQLAlchemy, MinIO

### å‰ç«¯å¼€å‘ (40% å·¥ä½œé‡)
- **ä»»åŠ¡:** ç»„ä»¶å¼€å‘ã€çŠ¶æ€ç®¡ç†ã€ç”¨æˆ·ç•Œé¢
- **æŠ€èƒ½:** TypeScript, React, Next.js, Tailwind CSS

### æµ‹è¯•å¼€å‘ (20% å·¥ä½œé‡)
- **ä»»åŠ¡:** æµ‹è¯•ç”¨ä¾‹ç¼–å†™ã€è‡ªåŠ¨åŒ–æµ‹è¯•ã€æ€§èƒ½æµ‹è¯•
- **æŠ€èƒ½:** Pytest, Jest, Cypress, æ€§èƒ½æµ‹è¯•å·¥å…·

---

**æ‰§è¡Œæ­¤è®¡åˆ’å°†ç¡®ä¿Story-2.4å®Œå…¨ç¬¦åˆæ‰€æœ‰éªŒæ”¶æ ‡å‡†ï¼Œå¹¶ä¸ºåç»­çš„Storyå¼€å‘å¥ å®šåšå®åŸºç¡€ã€‚**